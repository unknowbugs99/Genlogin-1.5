import{d as O,ad as R,a0 as j,W as U,ae as N,r as $,o as P,ak as F,X as V,Y as q,a5 as l,Z as v,a4 as c,a3 as i,c2 as J,a6 as b,a8 as M,c3 as W}from"./index.6e57c2f1.js";import{n as Y}from"./helpers.34775daf.js";import{_ as H}from"./Input.bebd1abf.js";import{_ as X}from"./Checkbox.cf4db95d.js";import{_ as Z}from"./Form.fcc80893.js";import{_ as z}from"./FormItem.5b33b5bf.js";import{_ as G}from"./Space.2af8f31d.js";import{_ as Q}from"./Spin.d2f52ed0.js";import"./use-merged-state.14d1217d.js";import"./get.556bbf62.js";import"./use-compitable.be4359a7.js";const k="SHA-256",x="SALT",L="PASSWORD",S=1e3,B=48,A=async(o,t,e,s,a)=>{const m=new TextEncoder("utf-8"),n=m.encode(e),f=await crypto.subtle.importKey("raw",n,"PBKDF2",!1,["deriveBits"]),y=m.encode(t),g={name:"PBKDF2",hash:o,salt:y,iterations:s};return await crypto.subtle.deriveBits(g,f,a*8)},E=async o=>{const e=o.slice(0,32),s=o.slice(32);return{key:await crypto.subtle.importKey("raw",e,{name:"AES-CBC"},!1,["encrypt","decrypt"]),iv:s}},ee=async(o,t)=>{const s=new TextEncoder("utf-8").encode(o);return await crypto.subtle.encrypt({name:"AES-CBC",iv:t.iv},t.key,s)},te=async(o,t)=>{const e=new TextDecoder("utf-8"),s=await crypto.subtle.decrypt({name:"AES-CBC",iv:t.iv},t.key,o);return e.decode(s)},ne=async o=>{const t=await A(k,x,L,S,B),e=await E(t);return await ee(JSON.stringify(o),e)},oe=async o=>{const t=await A(k,x,L,S,B),e=await E(t);return await te(o,e)},se=o=>{let t="";const e=new Uint8Array(o),s=e.byteLength;for(let a=0;a<s;a++)t+=String.fromCharCode(e[a]);return window.btoa(t)},ae=o=>{const t=window.atob(o),e=t.length,s=new Uint8Array(e);for(let a=0;a<e;a++)s[a]=t.charCodeAt(a);return s.buffer},re=""+new URL("banner-logo.6a51ffb4.png",import.meta.url).href,ce={class:"login-wrapper"},ie={class:"login-container"},pe=["src"],ue=b(" Keep me signed in "),de=l("div",{class:"flex justify-end"},[l("a",{href:"",class:"text-gray-400"},"Forgot password?")],-1),le={class:"block mt-2"},_e=b(" Login "),me={class:"mt-5 flex justify-center"},fe=b(" Register "),Ae=O({__name:"Login",setup(o){const t=R(),e=j(),{keepLoginInfo:s,keepLogin:a,planExpired:m}=U(e),n=N({submitting:!1,username:"",password:"",keepLogin:a.value||!1}),f=$(null),y=async()=>{if(s.value){const p=ae(s.value),r=await oe(p),u=JSON.parse(r),{username:d,password:w}=u;n.username=d,n.password=w}},g=async p=>{if(n.keepLogin){const r=await ne(p);e.$patch({keepLogin:!0,keepLoginInfo:se(r)})}else e.$patch({keepLogin:!1,keepLoginInfo:null})};y();const h=async()=>{if(n.submitting)return;const p={username:n.username,password:n.password};try{n.submitting=!0;const r=await W(p),{data:{success:u,data:d}}=r;u&&(await g({username:n.username.trim(),password:n.password}),await e.setAuth(d),m.value?(t.push({name:"main.pricing"}),window.$message.warning("Your plan expired")):(t.push({name:"main.home"}),window.$message.success("Login success"),await e.getAuth()))}catch{}finally{n.submitting=!1}};return P(()=>{f.value.focus()}),(p,r)=>{const u=H,d=z,w=X,C=M,K=F("router-link"),T=G,D=Z,I=Q;return V(),q("div",ce,[l("div",ie,[l("img",{src:v(re),class:"logo"},null,8,pe),c(I,{show:n.submitting},{default:i(()=>[c(D,{id:"form-login",onSubmit:J(h,["prevent"])},{default:i(()=>[c(d,{label:"Email"},{default:i(()=>[c(u,{ref_key:"firstInputRef",ref:f,value:n.username,"onUpdate:value":r[0]||(r[0]=_=>n.username=_),required:"",placeholder:"","allow-input":v(Y)},null,8,["value","allow-input"])]),_:1}),c(d,{label:"Password"},{default:i(()=>[c(u,{value:n.password,"onUpdate:value":r[1]||(r[1]=_=>n.password=_),type:"password",required:"",placeholder:""},null,8,["value"])]),_:1}),c(T,{vertical:""},{default:i(()=>[c(w,{checked:n.keepLogin,"onUpdate:checked":r[2]||(r[2]=_=>n.keepLogin=_)},{default:i(()=>[ue]),_:1},8,["checked"]),de,l("div",le,[c(C,{"attr-type":"submit",type:"primary",block:"",strong:"",disabled:n.submitting},{default:i(()=>[_e]),_:1},8,["disabled"])]),l("div",me,[c(K,{to:"/register",class:"text-blue-500"},{default:i(()=>[fe]),_:1})])]),_:1})]),_:1},8,["onSubmit"])]),_:1},8,["show"])])])}}});export{Ae as default};
