import{g as le,dm as ce,I as ue,d as B,X as i,Y as g,a5 as u,ci as de,dn as N,ad as _e,a1 as pe,W as b,j as me,a2 as P,ae as fe,o as he,_ as d,a3 as e,a4 as t,Z as n,$ as ge,ah as T,a_ as C,K as M,a6 as m,af as R,ab as L,ct as we,c7 as ke,dp as ve,dq as Se,dr as j,a8 as ye,ch as xe,h as D,cB as $e,cp as Ae}from"./index.6e57c2f1.js";import{u as be}from"./scriptAutomation.3bd79b9d.js";import{c as Ce}from"./chrome-icon.de460a19.js";import{f as Ne}from"./firefox-icon.a50947ef.js";import{I as Ee}from"./IosMore.7ba500b7.js";import{_ as Ie}from"./Space.2af8f31d.js";import{_ as Oe}from"./Dropdown.fdbd6883.js";import{_ as Pe}from"./Checkbox.cf4db95d.js";import{_ as Te}from"./Scrollbar.66e6813c.js";import{_ as Me,a as Re}from"./Grid.aa914ce4.js";import{_ as Le}from"./text.ab985a40.js";import{_ as je}from"./Select.cca7837d.js";import{_ as De}from"./FormItem.5b33b5bf.js";import"./validate.5eb70dfd.js";import"./Popover.1a4e3ffd.js";import"./get.556bbf62.js";import"./cssr.27de2d53.js";import"./use-merged-state.14d1217d.js";import"./use-compitable.be4359a7.js";import"./next-frame-once.e0fd6a2a.js";import"./Tag.f1f916fe.js";function Be(){const w=le(ce,null);return w===null&&ue("use-dialog","No outer <n-dialog-provider /> founded."),w}const Ve={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},qe=u("path",{d:"M416 221.25V416a48 48 0 0 1-48 48H144a48 48 0 0 1-48-48V96a48 48 0 0 1 48-48h98.75a32 32 0 0 1 22.62 9.37l141.26 141.26a32 32 0 0 1 9.37 22.62z",fill:"none",stroke:"currentColor","stroke-linejoin":"round","stroke-width":"32"},null,-1),ze=u("path",{d:"M256 56v120a32 32 0 0 0 32 32h120",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1),Je=u("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M176 288h160"},null,-1),Ue=u("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M176 368h160"},null,-1),Ye=[qe,ze,Je,Ue],He=B({name:"DocumentTextOutline",render:function(v,S){return i(),g("svg",Ve,Ye)}}),Qe=de("automation",{state:()=>({profile_ids:[],scripts:[],settings:{mode:N.SEQUENTIALLY,sandbox:!0},running:!1}),actions:{},persist:!0}),Fe=Qe,Ke=m(" Scripts "),We=m(" Create script "),Xe=u("span",null,"Profiles",-1),Ze={class:"flex justify-between"},Ge=m(" Clear all "),et=["src"],tt=["src"],ot={class:"mt-2"},nt=m(" Start "),st=m(" Stop "),at={name:"RunScript"},Ct=B({...at,setup(w){const v=_e(),S=pe(),k=be(),{profileList:V}=b(S),{list:E}=b(k),q=async()=>{S.getProfiles({offset:0,search:"",type:ke.ALL})},z=me(()=>V.value.filter(o=>o.profile_data.browser===P.CHROME)),J=fe({selectedScript:null,selectedProfiles:""}),U=()=>{k.setScript(),v.push({name:"main.automation.scriptEditor"})},Y=Be(),H=o=>{k.setScript(JSON.parse(JSON.stringify(o))),v.push({name:"main.automation.scriptEditor"})},Q=o=>{Y.warning({title:"Confirm",content:`Are you sure to delete ${o.name} script?`,positiveText:"Sure",negativeText:"No",onPositiveClick:()=>{k.deleteScript(o.id),J.selectedScript=null,window.$message.success("Script deleted")},onNegativeClick:()=>{}})},y=(o,s=null)=>()=>D(C,s,{default:()=>D(o)}),F=[{label:"Edit",key:"edit",icon:y($e)},{label:"Delete",key:"delete",icon:y(Ae,{color:"red"})},{label:"Export NodeJS script (coming soon)",key:"exportJS",icon:y(He),disabled:!0}],K=(o,s)=>{switch(o){case"edit":H(s);break;case"delete":Q(s);break}},W=[{label:"Sequentially every scripts",value:N.SEQUENTIALLY},{label:"Random one script",value:N.RANDOM_ONE}],X=Fe(),{profile_ids:c,scripts:_,settings:x,running:p}=b(X),Z=async()=>{try{const o=await ve();p.value=o}catch{p.value=!1}},G=(o,s)=>{if(o&&c.value.length===10){window.$message.warning("Limit 10 profiles run at once.");return}const r=c.value.findIndex(l=>l===s);o&&r===-1?c.value.push(s):c.value.splice(r,1)},ee=(o,s)=>{const r=_.value.findIndex(l=>l===s);o&&r===-1?_.value.push(s):_.value.splice(r,1)},te=async()=>{try{if(!_.value.length){window.$message.warning("No scripts selected");return}if(!c.value.length){window.$message.warning("No profiles selected");return}p.value=!0,window.$message.success("Automation started");const o=E.value.filter(r=>_.value.includes(r.id));await Se(c.value,o,x.value)&&(await j(),p.value=!1)}catch{window.$message.warning("Cannot start automation")}},oe=async()=>{try{p.value=!1,await j(),window.$message.success("Automation stopped")}catch{window.$message.success("Cannot stop automation")}};return he(async()=>{await Z(),await q()}),(o,s)=>{const r=ye,l=Ie,ne=Oe,f=xe,I=Pe,O=Te,$=Me,se=Le,ae=je,re=De,ie=Re;return i(),d(l,{id:"run-script",vertical:""},{default:e(()=>[t(ie,{"x-gap":"12",cols:3},{default:e(()=>[t($,null,{default:e(()=>[t(f,null,{header:e(()=>[t(l,{vertical:""},{default:e(()=>[Ke,t(r,{type:"primary",onClick:U},{icon:e(()=>[t(n(ge),{type:"add"})]),default:e(()=>[We]),_:1})]),_:1})]),default:e(()=>[t(O,{style:{"max-height":"500px"},class:"pr-5"},{default:e(()=>[t(l,{vertical:"",class:"ml-2"},{default:e(()=>[(i(!0),g(M,null,T(n(E),(a,A)=>(i(),d(I,{key:A,"on-update:checked":h=>ee(h,a.id),checked:n(_).includes(a.id)},{default:e(()=>[t(f,{title:a.name},{"header-extra":e(()=>[t(ne,{trigger:"hover",options:F,onSelect:h=>K(h,a)},{default:e(()=>[t(n(C),{class:"ml-10",size:"20"},{default:e(()=>[t(n(Ee))]),_:1})]),_:2},1032,["onSelect"])]),_:2},1032,["title"])]),_:2},1032,["on-update:checked","checked"]))),128))]),_:1})]),_:1})]),_:1})]),_:1}),t($,null,{default:e(()=>[t(f,{title:""},{header:e(()=>[t(l,{vertical:""},{default:e(()=>[Xe,u("div",Ze,[t(se,{type:"primary"},{default:e(()=>[m(" Selected: "+R(n(c).length),1)]),_:1}),n(c).length>0?(i(),d(r,{key:0,size:"small",ghost:"",type:"error",onClick:s[0]||(s[0]=a=>c.value=[])},{default:e(()=>[Ge]),_:1})):L("",!0)])]),_:1})]),default:e(()=>[t(O,{style:{"max-height":"500px"},class:"pr-5"},{default:e(()=>[t(l,{vertical:"",class:"ml-2"},{default:e(()=>[(i(!0),g(M,null,T(n(z),(a,A)=>(i(),d(I,{key:A,"on-update:checked":h=>G(h,a.id),checked:n(c).includes(a.id)},{default:e(()=>[t(f,{title:a.profile_data.name},{header:e(()=>[t(l,null,{default:e(()=>[a.profile_data.browser===n(P).CHROME?(i(),g("img",{key:0,src:n(Ce),alt:"",width:"24"},null,8,et)):(i(),g("img",{key:1,src:n(Ne),alt:"",width:"24"},null,8,tt)),u("span",null,R(a.profile_data.name),1)]),_:2},1024)]),"header-extra":e(()=>[a.filename?(i(),d(n(C),{key:0,class:"ml-10",size:"20",color:"#55b3e6"},{default:e(()=>[t(n(we))]),_:1})):L("",!0)]),_:2},1032,["title"])]),_:2},1032,["on-update:checked","checked"]))),128))]),_:1})]),_:1})]),_:1})]),_:1}),t($,null,{default:e(()=>[t(f,{title:"Settings"},{default:e(()=>[t(re,{span:12,path:"selectValue",label:"Mode","show-feedback":!1},{default:e(()=>[t(ae,{value:n(x).mode,"onUpdate:value":s[1]||(s[1]=a=>n(x).mode=a),clearable:"",options:W},null,8,["value"])]),_:1}),t(l,{vertical:""},{default:e(()=>[u("div",ot,[n(p)?(i(),d(r,{key:1,strong:"",block:"",type:"error",onClick:oe},{default:e(()=>[st]),_:1})):(i(),d(r,{key:0,strong:"",block:"",type:"success",onClick:te},{default:e(()=>[nt]),_:1}))])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}}});export{Ct as default};
